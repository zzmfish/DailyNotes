---
tags: 自动驾驶 读书
---

## 决策、规划和控制模块概述

#### 路由寻径

在 **宏观** 层面上指导无人驾驶系统的控制规划模块按照什么样的 **道路** 行驶，从而实现从起始点到目的地点的目的

#### 行为决策

决定无人车 **如何行驶**：跟车、避让等；

更为 **宏观** 的层面决策车辆的行为

#### 动作规划

###### ۰ 是什么

对一个 **短暂时间** t 内从 A 到 B 的 **中间路径点** 做规划；

选择途径的路径点；

速度、朝向、加速度、车轮转向等

###### ۰ 两点保证

在 **后续时间** 内，生成从 A 到 B的时空路径需要保持一定的 **一致性**；

在下有反馈控制的车辆和道路的物理属性范围内，是可以 **实际操作** 的

###### ۰ 冗余设计

接入感知和地图定位结果：

1. 可以处理行为决策模块计算完成后出现的 **新感知物体**，提高安全性；

2. 如果行为决策模块出了问题，也能实现 **最基本的避让**

#### 反馈控制

直接和无人车底层控制接口 **CAN-BUS** 对接；

通过一系列结合车身属性和外界物理因素的 **动力学计算**，转换成对车辆的 **线控信号**（油门、刹车、防线盘转动等）

<center><img style="margin:0 0 0 -200px" src="http://assets.processon.com/chart_image/60aba3dd5653bb690f76da85.png" /></center>

<center>🌼🌼🌼</center>

## 路由寻径

#### 有向带权图

把无人车在高精地图的 Lane 级别寻径问题，抽象成一个在 **有向带权图上的最短路径搜索** 问题；

在一定范围内所有可能经过的 Lane 进行分散撒 **点（LanePoint**） ；

连接 LanePoint 之间的 **权重** 代表无人车从一个点行驶到另一个点的 **潜在代价**；

![](http://zhouzm.cn/DailyNotes/assets/images/%E7%AC%AC%E4%B8%80%E6%9C%AC%E6%97%A0%E4%BA%BA%E9%A9%BE%E9%A9%B6%E6%8A%80%E6%9C%AF%E4%B9%A6-9-4-%E6%9C%89%E5%90%91%E5%B8%A6%E6%9D%83%E5%9B%BE.jpg)

#### 寻径算法

###### ۰ Dijkstra 算法

Dijkstra 算法从起始点开始，采用 **贪心算法** 的策略，每次遍历到始点距离最近且未访问过的顶点的邻接节点，直到扩展到终点为止。

![](http://zhouzm.cn/DailyNotes/assets/images/210714-Dijkstra%E7%AE%97%E6%B3%95.jpg)

###### **۰** A* 算法

![](http://zhouzm.cn/DailyNotes/assets/images/210714-AStar%E7%AE%97%E6%B3%95.jpg)





#### cost 设置策略

无人车路由寻径最重要的不是算法的选择，而是cost的设置策略。

| 场景                 | 策略                      |
| -------------------- | ------------------------- |
| 拥堵                 | LanePoint之间的 cost 提高 |
| 交通管制导致不能通行 | LanePoint之间不可达       |

#### 强/弱路由寻径

| 寻径方式   | 设计思想                                                     |
| ---------- | ------------------------------------------------------------ |
| 强 Routing | 发现一辆行驶非常缓慢的障碍车，下游模块（行为决策和动作规划）**严格遵守** 路由寻径模块的输出 |
| 弱 Routing | 发现一辆行驶非常缓慢的障碍车，无人车可能会 **短暂跨越** 到相邻的Lane，超过障碍车辆，再回到路由输出的Lane继续行驶 |

无论是强/弱 Routing，当需要紧急避让，或者无法执行当前的路由寻径结果，会 **按照安全第一的原则继续行驶**，并且 **重新发起路由寻径的请求**

<center>🌼🌼🌼</center>

## 行为决策

| 车辆周边信息         |                                                            |
| -------------------- | ---------------------------------------------------------- |
| 路由寻径结果         | 无人车为了到达目的地，需要进入的车道                       |
| 无人车的当前自身状态 | 位置、速度、朝向、所在车道、按照寻径路由需要进入的下一车道 |
| 无人车的历史信息     | 上一个行为决策周期的决策（跟车、停车、转弯、换道）         |
| 障碍物信息           | 车辆、行人（位置、速度、预测的轨迹）                       |
| 交通标识信息         | Lane的变化、红绿灯、人行道                                 |
| 交通规则             | 限速、红灯左拐                                             |

基于 **规则的决定性** 的行为决策系统仍然是目前工业界的主流

#### 有限状态马尔可夫决策过程

###### (S, A, P<sub>a</sub>, R<sub>a</sub>, γ) 五元组

| 符号                                | 含义                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| S                                   | 无人车所处的 **有限状态空间**；<br>位置维度可划分为**等距离的格子** |
| A                                   | 无人车的行为 **决策空间**，即无人车在任何状态下的所有行为空间的集合（跟车、换道、左/右转等） |
| P<sub>a</sub>(s, s') = (s \| s', a) | 无人车在状态 s 和动作 a 下，到达下一个 s' 的 **概率**        |
| R<sub>a</sub>(s, s')                | 无人车在动作 a 下，从状态 s 到状态 s'所得的 **激励**         |
| γ∈(0, 1)                            | 激励的衰减因子，**当前的激励比未来的激励重要**               |

行为决策 `π:S→A` 的选取目标是优化 **从当前时间点开始到未来的累计激励**。

通常可用 **动态编程**（Dynamic Programming）方法来求解。

###### 激励函数考虑的因素

* 到达目的地
* 安全性和避免碰撞
* 乘坐的舒适性和下游执行的平滑性

#### 基于场景划分和规则的行为决策设计

###### ۰ 综合行为决策

代表无人车行为决策层面的 **整体最高层的决策**；

为了便于下游直接执行，综合决策的指令集往往带有 **具体的指令参数数据**。

| 综合决策 | 参数                                         |
| -------- | -------------------------------------------- |
| 行驶     | 当前车道<br>目的车道                         |
| 跟车     | 当前车道<br>跟车对象<br>目的车速<br>跟车距离 |
| 转弯     | 当前车道<br>目的车道<br>转弯属性<br>转弯速度 |
| 换道     | 当前车道<br>换道车道<br>加速并道<br>减速并道 |
| 停车     | 当前车道<br>停车对象<br>停车位置             |

###### ۰ 个体行为决策

最终的综合决策是先经过 **场景划分**，产生每个场景下的 **个体决策**，再在综合考虑这些个体决策得出的；

个体决策也带有 **参数数据**；

个体决策和综合决策一起被 **传递给下游** 动作规划模块；

帮助下层模块更有效地实现路径规划；

提高调试的效率。

###### **۰** 场景划分构建和系统设计

场景是对一系列具有相对独立意义的无人车周边环境的划分。

![](http://assets.processon.com/chart_image/60f5f749f346fb62a742af2f.png)

场景定义是 **分层次** 的。

![](http://assets.processon.com/chart_image/60f7537507912919eb955833.png)

<center>🌼🌼🌼</center>

## 动作规划

#### 路径规划

###### ۰ 车辆模型、道路定义，以及候选路径生成

👉 车辆 **姿态向量**
$$
\vec x = (x, y, θ, k, v)
$$


| 变量 | 含义                 |
| ---- | -------------------- |
| x, y | 车辆在二维平面的位置 |
| θ    | 车的朝向             |
| k    | 曲率（θ的变化率）    |
| v    | 速度                 |

👉 **纵向位移** s：道路中心线切线方向的位移

👉 **横向位移** l：道路的中心线垂直方向的位移

👉 **SL坐标系统**：把道路表示为一个睡着中心线横向位移 s 的点集 
$$
{p(s, l_{k}): s ∈R^{+}}
$$

###### ۰ 基于路径点的有向图构建和搜索

#### 速度规划

<center>🌼🌼🌼</center>

## 反馈控制

#### 自行车模型

#### PID反馈控制
